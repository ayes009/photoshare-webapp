# ============================================
# FILE: .deployment
# ============================================
[config]
SCM_DO_BUILD_DURING_DEPLOYMENT=true

# ============================================
# Deployment Steps
# ============================================

# Step 1: Create folder structure
mkdir photoshare-webapp
cd photoshare-webapp
mkdir public

# Step 2: Create all files
# - Copy server.js (from previous artifact)
# - Copy index.html to public/ folder
# - Create package.json (above)
# - Create web.config (above)
# - Create .deployment (above)

# Step 3: Test locally FIRST
npm install
npm start
# Open http://localhost:8080 in browser
# Try logging in - should work!

# Step 4: Deploy to Azure
# Method A: VS Code
# - Install Azure App Service extension
# - Right-click folder → Deploy to Web App

# Method B: Azure CLI
az webapp up --name YOUR-WEB-APP-NAME --resource-group YOUR-RESOURCE-GROUP

# Method C: ZIP Deploy
# Create zip of entire folder (include node_modules if using ZIP)
# Go to Azure Portal → Web App → Deployment Center → ZIP Deploy

# ============================================
# Troubleshooting Commands
# ============================================

# Check if site is responding
curl https://YOUR-WEB-APP-NAME.azurewebsites.net/health

# Check API endpoint
curl -X POST https://YOUR-WEB-APP-NAME.azurewebsites.net/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"test","role":"creator"}'

# View logs
az webapp log tail --name YOUR-WEB-APP-NAME --resource-group YOUR-RESOURCE-GROUP

# Restart web app
az webapp restart --name YOUR-WEB-APP-NAME --resource-group YOUR-RESOURCE-GROUP

# ============================================
# Common Fixes
# ============================================

# Fix 1: Enable Application Logging
# Azure Portal → Web App → App Service logs
# - Application Logging: File System → Verbose
# - Save and restart

# Fix 2: Set Environment Variables
# Azure Portal → Web App → Configuration → Application settings
# Add:
# - WEBSITE_NODE_DEFAULT_VERSION = 18-lts
# - STORAGE_ACCOUNT = photosharestorage
# - SAS_TOKEN = your-sas-token

# Fix 3: Ensure correct startup
# Azure Portal → Web App → Configuration → General settings
# - Stack: Node
# - Major version: 18 LTS
# - Startup Command: node server.js

# Fix 4: Manual deployment test
# Go to: https://YOUR-WEB-APP-NAME.scm.azurewebsites.net
# - Debug console → CMD
# - Navigate to site/wwwroot
# - Run: npm install
# - Run: node server.js
# - Check for errors
